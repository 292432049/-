(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2cd4"],{"0jhr":function(e,t,a){"use strict";var o=a("w9Ne");a.n(o).a},VEXe:function(e,t,a){"use strict";a.r(t);var o=a("4cpu"),r=a("Yfch"),s=a("02iu"),l=a("9yna"),c=a("7Qib"),i={name:"StaffManage",components:{GridUnit:o.a},filters:{renderStatusValue:function(e){return["","负责人","员工","负责人"][e]||"未知"}},data:function(){return{sureLoading:!1,closeAddAccountTips_layer:!1,treeData:[],defaultProps:{children:"children",label:"depName",id:"depId"},userOrgRoom:!1,addDeName:"",roleChecked:"",selectDepName:"",inputDepart:"",isEditAccount:!1,layer_account:!1,userId:"",orgRoleEdit:!0,cityId:"",addAcountDepName:"",editRole:!1,accountForm:{mobile:"",name:"",gender:"",depId:"",role:"",hasAllRoomAuth:""},rules:{depId:[{required:!0,message:"请选择部门",trigger:"blur"}],mobile:[{required:!0,trigger:"blur",validator:function(e,t,a){Object(r.a)(t)?a():a(new Error("请输入正确的手机号"))}}],name:[{required:!0,message:"请输入名称",trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"blur"}],hasAllRoomAuth:[{required:!0,trigger:"blur",validator:function(e,t,a){""===t?a(new Error("请选择房源管理")):a()}}]},userDetails:!0,userOrg:!1,nowOrgObj:{depId:"",depName:""},genderOpts:[{value:1,label:"男"},{value:2,label:"女"}],parentOrg:{depId:"",depName:""},goRoomData:{},formData:{depId:"",keyword:""},colModels:[{prop:"name",label:"姓名",width:300},{prop:"role",label:"职位",width:150,slotName:"slot_role"},{prop:"depName",label:"部门",width:150},{prop:"roomStatus",label:"状态",width:150,slotName:"accountStatusHosting",type:"status"},{prop:"operate",label:"操作",slotName:"operateHosting"}],url:s.a.requestPath,method:s.a.staffInfoMethod,isMock:s.a.isMock}},created:function(){this.getTree()},methods:{searchParam:function(e){var t=this;"clear"===e&&(this.formData={depId:"",keyword:""},this.selectDepName=""),this.$nextTick(function(){t.$refs.refGridUnit.searchHandler()})},getTree:function(){var e=this;s.a.queryDepartmentApi().then(function(t){t.data&&(e.parentOrg.depId=t.data.depId,e.parentOrg.depName=t.data.depName,e.treeData=[{depName:t.data.depName,depId:t.data.depId,children:t.data.children}],e.cityId=e.$refs.overlayTree.getNode(t.data.depId).data.cityId)}).catch(function(e){})},editNodeclick:function(e){this.formData.depId=e.depId,this.selectDepName=e.depName,this.accountForm.depName=e.depName},accountNodeclick:function(e){this.addAcountDepName=e.depName,this.accountForm.depId=e.depId,this.cityId=this.$refs.overlayTree.getNode(e.depId).data.cityId},handleApply:function(){this.accountForm={mobile:"",name:"",gender:"",depId:"",role:""},this.layer_account=!0,this.orgRoleEdit=!0,this.userDetails=!1,this.isEditAccount=!1,this.userOrg=!1,this.userOrgRoom=!1,this.accountForm.depId=this.parentOrg.depId,this.addAcountDepName=this.parentOrg.depName,this.roleChecked=""},submitAccount:function(){var e=this;this.accountForm.role=this.roleChecked||2;var t=Object(c.b)(this.accountForm);this.$refs.accountForm.validate(function(a){a&&(e.sureLoading=!0,e.isEditAccount?(t.id=e.userId,l.e.editAccountApi(t).then(function(t){1*t.code==0?(e.$message({message:"编辑成功",type:"success"}),e.layer_account=!1,e.searchParam(),e.sureLoading=!1):e.$message({message:t.message,type:"warning"})}).catch(function(){setTimeout(function(){e.sureLoading=!1},2e3)})):l.e.addAccountAPi(t).then(function(a){0!==t.hasAllRoomAuth||e.isEditAccount?1*a.code==0?(e.$message({message:"新增账户成功",type:"success"}),e.layer_account=!1,e.searchParam(),e.layer_account=!1):(e.$message({message:a.message,type:"warning"}),e.layer_account=!1):(e.closeAddAccountTips_layer=!0,e.goRoomData=Object(c.b)(t),e.goRoomData.id=a.data)}).catch(function(){setTimeout(function(){e.sureLoading=!1},2e3)}))})},goAssionRoom:function(){var e=Object(c.b)(this.goRoomData);e.depName=this.$refs.overlayTree.getNode(this.goRoomData.depId).data.depName,e.cityId=this.cityId,this.$router.push({path:"/houseSource/allotroom",query:e})},closeAddAccountTips:function(){this.closeAddAccountTips_layer=!1,this.searchParam(),this.layer_account=!1},cancelAddAccount:function(){this.layer_account=!1,this.sureLoading=!1,this.$refs.accountForm.clearValidate()},assignHouse:function(e){return 1===e.role||3===e.role?(this.$message({message:"该账号拥有该部门下所有房源,无需设置",type:"warning"}),!1):1*e.status==2?(this.$message({message:"该账号已经停用，不能分配房源",type:"warning"}),!1):void this.$router.push({path:"/houseSource/allotroom",query:e})},roleClick:function(e){1===this.roleChecked?(this.userOrgRoom=!0,this.$set(this.accountForm,"hasAllRoomAuth",1)):this.userOrgRoom=!1,this.accountForm.role=this.roleChecked},editAccount:function(e){this.isEditAccount=!0,this.userDetails=!0,3===e.role?(this.userOrg=!0,this.userOrgRoom=!0,this.orgRoleEdit=!1):(this.userOrg=!1,this.userOrgRoom=!1,this.orgRoleEdit=!0),this.$set(this,"roleChecked",e.role),1===e.role&&(this.$set(this.accountForm,"hasAllRoomAuth",1),this.userOrgRoom=!0),this.accountForm={mobile:e.mobile,name:e.name,gender:e.gender,role:e.role},this.$set(this.accountForm,"hasAllRoomAuth",e.hasAllRoomAuth),this.layer_account=!0,this.addAcountDepName=e.depName,this.userId=e.id,this.accountForm.depId=e.depId,this.accountForm.role=e.role},changeAccountStatusMethod:function(e){var t=this;l.e.changeAccountStatusApi(e).then(function(){t.$message({type:"success",message:"操作成功!"})})},changeAccountStatus:function(e){var t=this,a={userId:e.id,status:e.status},o=1===e.status?"确认启用账号？":"确定停用账号？该员工账号下所有房源将会解除绑定。";this.$confirm(o," 提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.changeAccountStatusMethod(a),t.searchParam()}).catch(function(){console.log("取消"),t.searchParam()})},accountStatusText:function(e){return 1===e?"启用":2===e?"停用":void 0}}},n=(a("oll3"),a("0jhr"),a("KHd+")),u=Object(n.a)(i,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"layout_pageHeader"},[a("el-form",{staticClass:"model-search clearfix"},[a("div",{staticClass:"item-flex"},[a("el-form-item",[a("el-select",{staticClass:"item-select",attrs:{filterable:"",clearable:"",size:"small",placeholder:"请选择部门"},model:{value:e.selectDepName,callback:function(t){e.selectDepName=t},expression:"selectDepName"}},[a("el-tree",{ref:"overlayTree",attrs:{data:e.treeData,props:e.defaultProps,"highlight-current":!0,"expand-on-click-node":!1,"default-expanded-keys":[e.parentOrg.depId],"node-key":"depId"},on:{"node-click":e.editNodeclick}}),e._v(" "),a("el-option",{staticStyle:{display:"none"},attrs:{value:""}})],1)],1),e._v(" "),a("el-form-item",[a("el-input",{staticClass:"item-select",attrs:{placeholder:"请输入姓名/部门",size:"small",filterable:"",clearable:""},model:{value:e.formData.keyword,callback:function(t){e.$set(e.formData,"keyword",t)},expression:"formData.keyword"}})],1),e._v(" "),a("el-form-item",[a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",size:"small",icon:"el-icon-search"},on:{click:e.searchParam}},[e._v("查询")]),e._v(" "),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",icon:"el-icon-remove-outline"},on:{click:function(t){e.searchParam("clear")}}},[e._v("清空")]),e._v(" "),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",size:"small",icon:"el-icon-circle-plus-outline"},on:{click:function(t){e.handleApply()}}},[e._v("新增账号")])],1)],1)])],1),e._v(" "),a("div",{staticClass:"layout-container"},[a("GridUnit",{ref:"refGridUnit",attrs:{"form-options":e.formData,"data-method":e.method,url:e.url,"is-mock":e.isMock,columns:e.colModels,"show-pagination":!1,"list-field":"data"},scopedSlots:e._u([{key:"operateHosting",fn:function(t){return[a("el-row",[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){e.assignHouse(t.row)}}},[e._v("分配房源")]),e._v(" "),a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(a){e.editAccount(t.row)}}},[e._v("编辑")])],1)]}},{key:"slot_role",fn:function(t){return[e._v("\n        "+e._s(e._f("renderStatusValue")(t.row.role))+"\n      ")]}},{key:"accountStatusHosting",fn:function(t){return[a("el-switch",{staticClass:"accountSelectStatus",attrs:{"active-value":1,"inactive-value":2,"active-text":e.accountStatusText(t.row.status)},on:{change:function(a){e.changeAccountStatus(t.row)}},model:{value:t.row.status,callback:function(a){e.$set(t.row,"status",a)},expression:"scope.row.status"}})]}}])})],1),e._v(" "),a("el-dialog",{attrs:{title:e.isEditAccount?"编辑账号":"新增账号",visible:e.layer_account,width:"500px"},on:{close:e.cancelAddAccount}},[a("el-form",{ref:"accountForm",attrs:{model:e.accountForm,rules:e.rules,size:"small","label-position":"right",loading:"","label-width":"90px"}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"姓名",prop:"name"}},[a("el-input",{attrs:{disabled:e.userDetails,placeholder:"请输入姓名",filterable:"",clearable:"",maxlength:"10"},model:{value:e.accountForm.name,callback:function(t){e.$set(e.accountForm,"name",t)},expression:"accountForm.name"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"性别","label-width":"60px",prop:"gender"}},[a("el-select",{attrs:{disabled:e.userDetails,filterable:"",clearable:""},model:{value:e.accountForm.gender,callback:function(t){e.$set(e.accountForm,"gender",t)},expression:"accountForm.gender"}},e._l(e.genderOpts,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:"手机号码",prop:"mobile"}},[a("el-input",{attrs:{placeholder:"请输入手机号码",filterable:"",clearable:""},model:{value:e.accountForm.mobile,callback:function(t){e.$set(e.accountForm,"mobile",t)},expression:"accountForm.mobile"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:"所属部门",prop:"depId"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:e.userOrg},model:{value:e.addAcountDepName,callback:function(t){e.addAcountDepName=t},expression:"addAcountDepName"}},[a("el-tree",{ref:"overlayTree",attrs:{data:e.treeData,props:e.defaultProps,"highlight-current":!0,"expand-on-click-node":!1,"default-expanded-keys":[e.parentOrg.depId],"node-key":"depId"},on:{"node-click":e.accountNodeclick}}),e._v(" "),a("el-option",{staticStyle:{display:"none"},attrs:{value:""}})],1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:"房源管理",prop:"hasAllRoomAuth"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:e.userOrgRoom,clearable:""},model:{value:e.accountForm.hasAllRoomAuth,callback:function(t){e.$set(e.accountForm,"hasAllRoomAuth",t)},expression:"accountForm.hasAllRoomAuth"}},[a("el-option",{attrs:{value:0,label:"部门旗下部分房源"}}),e._v(" "),a("el-option",{attrs:{value:1,label:"部门旗下所有房源"}})],1)],1)],1)],1),e._v(" "),e.orgRoleEdit?a("el-row",[a("el-form-item",{attrs:{label:"部门负责人",prop:"orgRole"}},[a("el-checkbox",{attrs:{"true-label":1},on:{change:e.roleClick},model:{value:e.roleChecked,callback:function(t){e.roleChecked=t},expression:"roleChecked"}})],1)],1):e._e()],1),e._v(" "),a("div",{staticClass:"dialog-footer",staticStyle:{"margin-top":"-30px"},attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{loading:e.sureLoading,type:"primary"},on:{click:e.submitAccount}},[e._v("确定")]),e._v(" "),a("el-button",{on:{click:e.cancelAddAccount}},[e._v("取消")])],1)],1),e._v(" "),a("el-dialog",{attrs:{visible:e.closeAddAccountTips_layer,title:"新增账号成功",width:"30%"},on:{close:e.closeAddAccountTips}},[a("p",{staticStyle:{"margin-bottom":"40px","text-align":"center"}},[e._v("新增账号成功，记得给账号分配房源")]),e._v(" "),a("div",{staticClass:"dialog-footer",staticStyle:{"margin-top":"-30px"},attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.goAssionRoom}},[e._v("去分配房源")]),e._v(" "),a("el-button",{on:{click:e.closeAddAccountTips}},[e._v("取消")])],1)])],1)},[],!1,null,"eae7c538",null);u.options.__file="staffManage.vue";t.default=u.exports},Yfch:function(e,t,a){"use strict";function o(e){return/^(((13[0-9]{1})|(14[0-9]{1})|(17[0-9]{1})|(15[0-3]{1})|(15[4-9]{1})|(18[0-9]{1})|(199))+\d{8})$/.test(e)}a.d(t,"a",function(){return o})},oll3:function(e,t,a){"use strict";var o=a("saTq");a.n(o).a},saTq:function(e,t,a){},w9Ne:function(e,t,a){}}]);